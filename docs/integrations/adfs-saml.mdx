---
displayed_sidebar: integrationsSidebar

---

# Microsoft AD FS

This guide walks you through configuring Single Sign-On (SSO) with Microsoft Active Directory Federation Services (AD FS) as your Identity Provider.

## What you'll learn

- How to set up a relying party trust in AD FS
- How to configure claims issuance policies
- How to establish the connection between AD FS and your application

## Before you begin

To successfully set up AD FS SAML integration, you'll need:

- Administrative access to your AD FS Management Console
- Access to the Admin Portal of the application you're integrating Microsoft AD FS with.

## Configuration steps

1. **Choose Microsoft AD FS as your identity provider** to begin the configuration in admin portal. Download the Metadata XML file. We will provide this later to AD FS Server going forward.

   <figure className="limited-width">
     ![Choose Identity Provider](@site/docs/sso/assets/integrations/microsoft-ad-fs/-1.png)
     <figcaption>Choose Identity Provider</figcaption>
   </figure>

2. **Open AD FS Management Console** and launch Server Manager

3. **Create a Relying Party Trust**
   - In the left navigation pane, expand 'ADFS'
   - Right-click 'Relying Party Trusts'
   - Select 'Add Relying Party Trust'

   <figure className="limited-width">
     ![AD FS Management Console](@site/docs/sso/assets/integrations/microsoft-ad-fs/0.png)
     <figcaption>AD FS Management Console</figcaption>
   </figure>

4. **Configure federation metadata file**
   - Select 'Claims aware' as the trust type and click 'Next'
   - Choose 'Enter data about the relying party manually'
   - Click 'Next' to proceed

   <figure className="limited-width">
     ![Select Data Source](@site/docs/sso/assets/integrations/microsoft-ad-fs/2.png)
     <figcaption>Select Data Source</figcaption>
   </figure>

   You can configure the relying party trust using either of these methods:
     - Download and import the Metadata XML file from your application's Admin Portal
     - Enter the Metadata URL directly (if network access allows)

5. **Set Display Name**
   - Enter a descriptive name for your application (e.g., "Your App via Scalekit")
   - Click 'Next' to continue

   <figure className="limited-width">
     ![Specify Display Name](@site/docs/sso/assets/integrations/microsoft-ad-fs/3.png)
     <figcaption>Specify Display Name</figcaption>
   </figure>

6. **Configure Access Control**
   - Select an appropriate access control policy
   - For testing purposes, select 'Permit everyone'
   - Click 'Next' to proceed

7. **Review Trust Configuration**
   - Verify the following settings:
     - Monitoring configuration
     - Endpoints
     - Encryption settings
   - Click 'Next' to continue

   <figure className="limited-width">
     ![Review Trust Configuration](@site/docs/sso/assets/integrations/microsoft-ad-fs/5.png)
     <figcaption>Review Trust Configuration</figcaption>
   </figure>

   The wizard will complete with the 'Claim Issuance Policy' option automatically selected.

   <figure className="limited-width">
     ![Edit Claim Issuance Policy](@site/docs/sso/assets/integrations/microsoft-ad-fs/6.png)
     <figcaption>Edit Claim Issuance Policy</figcaption>
   </figure>

8. **Create Claim Rules**
   - Click 'Add Rule' to create a new claim rule
   - Select 'Send LDAP Attributes as Claims' template

   <figure className="limited-width">
     ![Create Claim Rule](@site/docs/sso/assets/integrations/microsoft-ad-fs/7.png)
     <figcaption>Create Claim Rule</figcaption>
   </figure>

   <figure className="limited-width">
     ![Configure Attribute Mapping](@site/docs/sso/assets/integrations/microsoft-ad-fs/8.png)
     <figcaption>Configure Attribute Mapping</figcaption>
   </figure>

9. **Map User Attributes**
   - Enter a descriptive rule name (e.g., "ExampleApp via Scalekit")
   - Configure the following attribute mappings:
     - `E-Mail-Addresses` → E-Mail Address
     - `Given-Name` → Given Name
     - `Surname` → Surname
     - `User-Principal-Name` → Name ID
   - Click 'Finish' to complete the mapping

   <figure className="limited-width">
     ![Map User Attributes](@site/docs/sso/assets/integrations/microsoft-ad-fs/9.png)
     <figcaption>Map User Attributes</figcaption>
   </figure>

10. **Complete Admin Portal Configuration**
    - Navigate to Identity Provider Configuration in the Scalekit Admin Portal
    - Select "Configure Manually"
    - Enter these required details:
     - Microsoft AD FS Identifier: `http://scalekit.local/adfs/services/trust`
     - Login URL: `http://scalekit.local/adfs/ls`
     - Certificate:
       1. Access `https://scalekit.local/FederationMetadata/2007-06/FederationMetadata.xml`
       2. Locate the text after the first `X509Certificate` tag
       3. Copy and paste this certificate into the "Certificate" field
   - Click "Update" to save the configuration

   <figure className="limited-width">
     ![Update Configuration](@site/docs/sso/assets/integrations/microsoft-ad-fs/12.png)
     <figcaption>Update Configuration</figcaption>
   </figure>

   The above endpoints are AD FS endpoints. You can find them listed in AD FS Console > Service > Endpoints > Tokens and Metadata sections

11. **Test the Integration**
    - In the Scalekit Admin Portal, click "Test Connection"
    - You will be redirected to the AD FS login page
    - Enter your AD FS credentials
    - Verify successful redirection back to the Admin Portal with the correct user attributes

   <figure className="limited-width">
     ![Test Integration](@site/docs/sso/assets/integrations/microsoft-ad-fs/11.png)
     <figcaption>Test Integration</figcaption>
   </figure>

## Verification

After completing the configuration, test the SSO integration by:

1. Logging out of your application
2. Attempting to log in using the SSO option
3. Verifying you're redirected to AD FS and can authenticate successfully

## Troubleshooting

If you encounter issues with your AD FS integration:

- Verify all claim mappings are correctly configured
- Check that the Metadata URL is accessible from Scalekit
- Ensure your AD FS server's clock is synchronized
- Review AD FS event logs for any authentication errors
