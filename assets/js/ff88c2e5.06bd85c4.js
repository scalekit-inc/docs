"use strict";(self.webpackChunkscalekit_docs=self.webpackChunkscalekit_docs||[]).push([[3482],{1022:(e,i,t)=>{t.r(i),t.d(i,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>c});var n=t(4848),s=t(8453);const r={},o="Implement Identity Provider (IdP) initiated SSO",a={id:"sso/guides/setup-sso/implement-idp-initiated-sso",title:"Implement Identity Provider (IdP) initiated SSO",description:"IdP-initiated SSO allows users to log into your application directly from their identity provider's portal. While convenient, it poses security risks such as stolen SAML assertions.",source:"@site/docs/sso/guides/setup-sso/implement-idp-initiated-sso.mdx",sourceDirName:"sso/guides/setup-sso",slug:"/sso/guides/setup-sso/implement-idp-initiated-sso",permalink:"/sso/guides/setup-sso/implement-idp-initiated-sso",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"homeSidebar",previous:{title:"Customize Admin Portal",permalink:"/sso/domain-and-theme-customization"},next:{title:"Handle SSO Errors",permalink:"/sso/guides/setup-sso/error-handling"}},d={},c=[{value:"Security Risks",id:"security-risks",level:2},{value:"How Attackers Steal SAML Assertions",id:"how-attackers-steal-saml-assertions",level:3},{value:"The Challenge for Service Providers",id:"the-challenge-for-service-providers",level:3},{value:"Mitigating Security Risks: Convert IdP-initiated to SP-initiated SSO",id:"mitigating-security-risks-convert-idp-initiated-to-sp-initiated-sso",level:2},{value:"Advantages",id:"advantages",level:2}];function l(e){const i={code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components},{SimpleCode:r,TabItem:o,Tabs:a}=i;return r||u("SimpleCode",!0),o||u("TabItem",!0),a||u("Tabs",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.h1,{id:"implement-identity-provider-idp-initiated-sso",children:"Implement Identity Provider (IdP) initiated SSO"}),"\n",(0,n.jsx)(i.p,{children:"IdP-initiated SSO allows users to log into your application directly from their identity provider's portal. While convenient, it poses security risks such as stolen SAML assertions."}),"\n",(0,n.jsx)(i.p,{children:"In IdP initiated SSO:"}),"\n",(0,n.jsxs)(i.ol,{children:["\n",(0,n.jsx)(i.li,{children:"The user logs into their identity provider portal and selects your application."}),"\n",(0,n.jsx)(i.li,{children:"The identity provider sends the user's details as assertions to your application."}),"\n",(0,n.jsx)(i.li,{children:"Your application validates the assertions, retrieves the user information, and if everything checks out, logs the user in."}),"\n"]}),"\n",(0,n.jsx)("figure",{children:(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.img,{alt:"IdP initiated SSO\nworkflow",src:t(5152).A+"",width:"3536",height:"2168"}),"\n",(0,n.jsx)("figcaption",{children:"IdP initiated SSO workflow"})]})}),"\n",(0,n.jsx)(i.p,{children:"Since the login is initiated from the identity provider's portal, this flow is called IdP-initiated SSO."}),"\n",(0,n.jsx)(i.h2,{id:"security-risks",children:"Security Risks"}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"Stolen SAML Assertions"}),": Attackers can steal these assertions and use them to gain unauthorized access. If an attacker manages to steal these assertions, they can:"]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Inject them into another service provider, gaining access to that user's account"}),"\n",(0,n.jsx)(i.li,{children:"Inject them back into your application with altered assertions, potentially elevating their privileges"}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:"With a stolen SAML assertion, an attacker can gain access to your application as the compromised user, bypassing the usual authentication process. This compromised behavior is much harder with Service Provider (SP) initiated SSO flow."}),"\n",(0,n.jsx)(i.h3,{id:"how-attackers-steal-saml-assertions",children:"How Attackers Steal SAML Assertions"}),"\n",(0,n.jsx)(i.p,{children:"Attackers can steal SAML assertions through various methods:"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Man-In-The-Middle (MITM) Attacks"}),": Intercepting and replacing the SAML response during transmission."]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Open Redirect Attacks"}),": Exploiting improper endpoint validation to redirect the SAML response to a malicious server."]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Leaky Logs and Headers"}),": Sensitive information, including SAML assertions, can be leaked through logs or headers."]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Browser-Based Attacks"}),": Exploiting browser vulnerabilities to steal SAML assertions"]}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"the-challenge-for-service-providers",children:"The Challenge for Service Providers"}),"\n",(0,n.jsx)(i.p,{children:"The chief problem with stolen assertions is that everything appears legitimate to the service provider. The message and assertion are valid, issued by the expected identity provider, and signed with the expected key.\nHowever, the service provider cannot verify whether the assertions are stolen or not. This makes it difficult to detect and prevent unauthorized access through stolen SAML assertions."}),"\n",(0,n.jsx)(i.h2,{id:"mitigating-security-risks-convert-idp-initiated-to-sp-initiated-sso",children:"Mitigating Security Risks: Convert IdP-initiated to SP-initiated SSO"}),"\n",(0,n.jsx)(i.p,{children:"Despite the security risks, IdP initiated SSO offers significant convenience to end users, allowing them to easily log into various applications used within their organization. As such, it's important for your application to support it.\nTo support it securely, convert the incoming IdP-initiated request to an SP-initiated SSO flow. Refer the below diagram for the recommended workflow from Scalekit."}),"\n",(0,n.jsx)("figure",{children:(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.img,{alt:"Scalekit&#39;s recommended workflow for IdP initiated\nSSO",src:t(344).A+"",width:"4936",height:"4432"}),"\n",(0,n.jsx)("figcaption",{children:"Scalekit's recommended workflow for IdP initiated SSO"})]})}),"\n",(0,n.jsxs)(i.ol,{children:["\n",(0,n.jsxs)(i.li,{children:["When Scalekit receives an IdP-initiated SSO request from one of your customers, it pings your configured default ",(0,n.jsx)(r,{children:"redirect_uri"})," with the ",(0,n.jsx)(r,{children:"connection_id"})," as a request parameter:"]}),"\n"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-sh",children:"https://default_redirect_uri?idp_initiated_sso=success&connection_id=conn_12442\n"})}),"\n",(0,n.jsxs)(i.ol,{start:"2",children:["\n",(0,n.jsxs)(i.li,{children:["In your redirect URI handler, check for the ",(0,n.jsx)(r,{children:"idp_initiated_sso"}),' parameter. If it\'s present and set to "success", construct a new authorization URL using the ',(0,n.jsx)(r,{children:"connection_id"}),":"]}),"\n"]}),"\n",(0,n.jsxs)(a,{groupId:"tech-stack",queryString:!0,children:[(0,n.jsx)(o,{value:"nodejs",label:"Node.js",children:(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-javascript",metastring:"showLineNumbers",children:"const {\n  code,\n  error,\n  error_description,\n  idp_initiated_sso,\n  connection_id,\n  relay_state,\n} = req.query;\n\nif (error) {\n  // handle errors\n}\n\n// check if this is an idp initiated login\nif (idp_initiated_sso && idp_initiated_sso === 'success') {\n  // handle idp initiated login\n  const authorizationURL = scalekit.getAuthorizationUrl(redirectUri, {\n    connectionId: connection_id,\n    ...(relay_state && { state: relay_state }), // optionally pass relay state as state parameter\n  });\n\n  // next step is to redirect the user to this authorizationURL\n}\n\n// check if state received is same as what was sent as part of authorization-url\n\n// if there are no errors and if this is not an IdP initiated SSO, then authenticate with the code\nconst res = await sc.authenticateWithCode({\n  code: code,\n  redirectUri: redirectUri,\n});\n\n// res.user has the authenticated user's details\nconst userEmail = res.user.email;\n\n// next step is to create a session for this user and allow access to your application resources\n"})})}),(0,n.jsx)(o,{value:"python",label:"Python",children:(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-python",metastring:"showLineNumbers",children:"from scalekit import ScalekitClient, AuthorizationUrlOptions, CodeAuthenticationOptions\n\nscalekit_client = ScalekitClient(\n  <SCALEKIT_ENVIRONMENT_URL>,\n  <SCALEKIT_CLIENT_ID>,\n  <SCALEKIT_CLIENT_SECRET>\n)\n\ncode = request.args.get('code')\nerror = request.args.get('error')\nerror_description = request.args.get('error_description')\nidp_initiated_sso = request.args.get('idp_initiated_sso')\nconnection_id = request.args.get('connection_id')\nrelay_state = request.args.get('relay_state')\n\nif error:\n  # handle errors\n\n# check if this is an idp initiated login\nif idp_initiated_sso and idp_initiated_sso == 'success':\n  # handle idp initiated login\n  authorization_url_options = AuthorizationUrlOptions(\n    connection_id=connection_id,\n    state=relay_state\n  )\n  authorization_url = scalekit_client.get_authorization_url(\n    redirect_uri,\n    authorization_url_options\n  )\n  # next step is to redirect the user to this authorization_url\n\nresult = scalekit_client.authenticate_with_code(code, <redirect_uri>)\n# result.user has the authenticated user's details\nuser_email = result.user.email\n\n# next step is to create a session for this user and allow access to your application resources\n"})})}),(0,n.jsx)(o,{value:"golang",label:"Golang",children:(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-go",metastring:"showLineNumbers",children:'import (\n  "github.com/scalekit/scalekit-sdk-go"\n)\n\nscalekitClient := scalekit.NewScalekitClient(\n  <SCALEKIT_ENVIRONMENT_URL>,\n  <SCALEKIT_CLIENT_ID>,\n  <SCALEKIT_CLIENT_SECRET>\n)\n\ncode := r.URL.Query().Get("code")\nerror := r.URL.Query().Get("error")\nerrorDescription := r.URL.Query().Get("error_description")\nidpInitiatedSSO := r.URL.Query().Get("idp_initiated_sso")\nconnectionId := r.URL.Query().Get("connection_id")\nrelayState := r.URL.Query().Get("relay_state")\n\nif error != "" {\n  // handle errors\n}\n\n// check if this is an idp initiated login\nif idpInitiatedSSO != "" && idpInitiatedSSO == "success" {\n  // handle idp initiated login\n  authorizationURLOptions := scalekit.AuthorizationURLOptions{\n    ConnectionID: connectionID,\n    State: relayState,\n  }\n  authorizationURL := scalekitClient.GetAuthorizationURL(\n    redirectURI,\n    authorizationURLOptions,\n  )\n  // next step is to redirect the user to this authorizationURL\n}\n\nresult, err := scalekitClient.AuthenticateWithCode(code, redirectURI)\nif err != nil {\n  // handle errors\n}\n\n// result.User has the authenticated user\'s details\nuserEmail := result.User.Email\n\n// next step is to create a session for this user and allow access to your application resources\n'})})})]}),"\n",(0,n.jsx)(i.h2,{id:"advantages",children:"Advantages"}),"\n",(0,n.jsx)(i.p,{children:"The advantages of using this approach are:"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Enhanced Security"}),": Overcomes the security risks of handling IdP-initiated SSO"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Seamless Experience"}),": The additional redirect is almost instantaneous, providing a smooth user experience"]}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:"By following these steps, you can support IdP-initiated SSO while maintaining a high level of security for your users"})]})}function h(e={}){const{wrapper:i}={...(0,s.R)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}function u(e,i){throw new Error("Expected "+(i?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},5152:(e,i,t)=>{t.d(i,{A:()=>n});const n=t.p+"assets/images/idp-initiated-sso-54c30d596f68dfa60e0e44861ac41e32.png"},344:(e,i,t)=>{t.d(i,{A:()=>n});const n=t.p+"assets/images/idp_initiated_sso_with_scalekit-8c490e6db4b35a7ac94c517726b182b2.png"},8453:(e,i,t)=>{t.d(i,{R:()=>o,x:()=>a});var n=t(6540);const s={},r=n.createContext(s);function o(e){const i=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),n.createElement(r.Provider,{value:i},e.children)}}}]);